<app-navbar></app-navbar>
<div class="project-container">
  <div class="notification-overlay">
    <div class="message-popup success-message" *ngIf="updateSuccess">
      <div class="message-content">
        <div class="message-icon success-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <div class="message-text">
          <h3>Success!</h3>
          <p>Project details have been saved successfully.</p>
        </div>
        <button class="close-message" (click)="dismissMessage()">×</button>
      </div>
    </div>
    <div class="message-popup error-message" *ngIf="errorMessage">
      <div class="message-content">
        <div class="message-icon error-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        </div>
        <div class="message-text">
          <h3>Error</h3>
          <p>{{ errorMessage }}</p>
        </div>
        <button class="close-message" (click)="dismissMessage()">×</button>
      </div>
    </div>
    <div class="message-popup success-message" *ngIf="projectDeletedSuccess">
      <div class="message-content">
        <div class="message-icon success-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <div class="message-text">
          <h3>Project Deleted</h3>
          <p>Project has been deleted successfully.</p>
        </div>
        <button class="close-message" (click)="dismissMessage()">×</button>
      </div>
    </div>
    <div class="message-popup success-message" *ngIf="specsUpdatedSuccess">
      <div class="message-content">
        <div class="message-icon success-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <div class="message-text">
          <h3>Specifications Updated</h3>
          <p>House specifications have been updated successfully.</p>
        </div>
        <button class="close-message" (click)="dismissMessage()">×</button>
      </div>
    </div>
  </div>
  <div *ngIf="loading.project && !project" class="loading-container">
    <div class="spinner"></div>
    <p>Loading project details...</p>
  </div>
  <div *ngIf="error.project && !project" class="error-container">
    <div class="error-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
    </div>
    <h3>Error Loading Project</h3>
    <p>{{ error.project }}</p>
    <button class="retry-button" (click)="loadProject()">Retry</button>
  </div>
  <div *ngIf="project" class="project-details-wrapper">
    <div *ngIf="loading.project" class="loading-overlay">
      <div class="spinner"></div>
      <p>Updating project...</p>
    </div>
    <div class="project-header-card">
      <div class="project-header-content">
        <div class="project-title-section">
          <div *ngIf="!editMode.project" class="project-title">
            <h1>{{ project.address }}</h1>
            <div class="status-badge" [ngClass]="'status-' + project.status">
              {{ getStatusDisplayText(project.status) }}
            </div>
          </div>
          <div *ngIf="editMode.project" class="project-title-edit">
            <div class="form-group">
              <label for="projectAddress">Property Address</label>
              <input type="text" id="projectAddress" [(ngModel)]="project.address" class="form-control">
            </div>
            
            <div class="form-group">
              <label for="projectStatus">Status</label>
              <select id="projectStatus" [(ngModel)]="project.status" class="form-control">
                <option *ngFor="let option of getStatusOptions()" [ngValue]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="project-actions">
          <div *ngIf="!editMode.project" class="button-group">
            <button class="primary-button" (click)="toggleProjectEditMode()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
              Edit Project
            </button>
            <button class="danger-button" (click)="deleteProject()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
              Delete
            </button>
          </div>
          <div *ngIf="editMode.project" class="button-group">
            <button class="secondary-button" (click)="cancelEditProject()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              Cancel
            </button>
            <button class="primary-button" (click)="saveProject()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
              </svg>
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="content-grid">
      <div class="card project-info-card">
        <div class="card-header">
          <h2>Project Information</h2>
        </div>
        <div class="card-body">
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Created</div>
              <div class="info-value">{{ formatDate(project.createdAt) }}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Last Updated</div>
              <div class="info-value">{{ formatDateTime(project.updatedAt) }}</div>
            </div>
          </div>
        </div>
        <div class="card-header">
          <h2>Description</h2>
        </div>
        <div class="card-body">
          <div *ngIf="!editMode.project" class="description-content">
            <p>{{ project.description || 'No description provided.' }}</p>
          </div>
          <div *ngIf="editMode.project" class="description-edit">
            <div class="form-group">
              <textarea [(ngModel)]="project.description" placeholder="Enter project description..." rows="5" class="form-control"></textarea>
            </div>
          </div>
        </div>
    </div>
      <div class="card specs-card">
        <div class="card-header">
          <h2>House Specifications</h2>
          <div class="card-actions">
          
            <div *ngIf="!editMode.houseSpecs && houseSpecsExist" class="button-group">
              <button class="primary-button" (click)="toggleHouseSpecsEditMode()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Edit Specifications
              </button>
            </div>
            <div *ngIf="editMode.houseSpecs" class="button-group">
              <button class="secondary-button" (click)="cancelEditSpecs()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="15" y1="9" x2="9" y2="15"></line>
                  <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                Cancel
              </button>
              <button class="primary-button" (click)="saveHouseSpecifications()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                  <polyline points="17 21 17 13 7 13 7 21"></polyline>
                  <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Save Changes
              </button>
            </div>
          </div>
        </div>
        <div *ngIf="loading.houseSpecs && !houseSpecsExist" class="card-body loading-container">
          <div class="spinner"></div>
          <p>Loading house specifications...</p>
        </div>
        <div *ngIf="!loading.houseSpecs && !houseSpecsExist" class="card-body empty-specs">
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <h3>No House Specifications</h3>
            <p>Add specifications to visualize the house design</p>
            <button class="primary-button" (click)="addHouseSpecifications()">Add Specifications</button>
          </div>
        </div>
        <div *ngIf="!loading.houseSpecs && houseSpecsExist && houseSpecs" class="card-body">
          <div *ngIf="loading.houseSpecs" class="loading-overlay">
            <div class="spinner"></div>
            <p>Updating specifications...</p>
          </div>
          
          <div class="specs-content">
            <div class="specs-section">
              <h3>House Shape</h3>
              <div *ngIf="!editMode.houseSpecs" class="shape-display">
                <div class="shape-info">
                  <img [src]="getSelectedShapeImagePath()" alt="House Shape" class="shape-image">
                  <span class="shape-name">{{ getShapeTypeName(houseSpecs.shapeType) }}</span>
                </div>
              </div>
              <div *ngIf="editMode.houseSpecs" class="shape-selection">
                <label for="shapeType">Select House Shape</label>
                <div class="shape-options">
                  <div *ngFor="let shape of getShapeTypeOptions()" 
                       class="shape-option" 
                       [class.selected]="houseSpecs.shapeType === shape.value"
                       (click)="selectShapeType(shape.value)">
                    <img [src]="shape.imagePath" [alt]="shape.label" class="shape-thumbnail">
                    <span class="shape-label">{{ shape.label }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="specs-section parameters-section">
              <div class="parameters-grid">
                <div class="parameter-group">
                  <h3>Basic Parameters</h3>
                  <div class="parameter-item roof-type-item">
                    <label>Roof Type</label>
                    <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ getRoofTypeName(houseSpecs.roofType) }}</div>
                    <div *ngIf="editMode.houseSpecs" class="roof-type-selection">
                      <div class="roof-options">
                        <div *ngFor="let option of getRoofTypeOptions()" 
                             class="roof-option" 
                             [class.selected]="houseSpecs.roofType === option.value"
                             (click)="houseSpecs.roofType = option.value">
                          <div class="roof-thumbnail">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                              <g *ngIf="option.value === RoofType.Flat">
                                <path d="M3 10h18"></path>
                                <path d="M3 10v8a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-8"></path>
                              </g>
                              <g *ngIf="option.value === RoofType.Gable">
                                <path d="M3 10l9-7 9 7"></path>
                                <path d="M3 10v8a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-8"></path>
                              </g>
                              <g *ngIf="option.value === RoofType.Hip">
                                <path d="M3 10l2-2h14l2 2"></path>
                                <path d="M5 8l7-5 7 5"></path>
                                <path d="M3 10v8a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-8"></path>
                              </g>
                              <g *ngIf="option.value === RoofType.Mansard">
                                <path d="M3 14l3-4h12l3 4"></path>
                                <path d="M3 14v4a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-4"></path>
                              </g>
                              <g *ngIf="option.value === RoofType.Shed">
                                <path d="M3 13l18-6"></path>
                                <path d="M3 13v5a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-5"></path>
                              </g>
                              <g *ngIf="option.value === RoofType.Pyramid">
                                <path d="M12 4l-9 8h18z"></path>
                                <path d="M3 12v6a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-6"></path>
                              </g>
                              <g *ngIf="option.value !== RoofType.Flat && 
                                        option.value !== RoofType.Gable && 
                                        option.value !== RoofType.Hip && 
                                        option.value !== RoofType.Mansard && 
                                        option.value !== RoofType.Shed && 
                                        option.value !== RoofType.Pyramid">
                                <path d="M3 10l9-7 9 7"></path>
                                <path d="M3 10v8a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-8"></path>
                              </g>
                            </svg>
                          </div>
                          <span class="roof-label">{{ option.label }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div *ngIf="houseSpecs.shapeType !== undefined" class="parameter-group">
                  <h3>Dimensions</h3>
                  <div *ngIf="houseSpecs.shapeType === HouseShapeType.Rectangular" class="dimension-parameters">
                    <div class="parameter-item">
                      <label>Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['length'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['length']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['width'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['width']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="houseSpecs.shapeType === HouseShapeType.Square" class="dimension-parameters">
                    <div class="parameter-item">
                      <label>Size</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['size'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['size']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="houseSpecs.shapeType === HouseShapeType.LShape" class="dimension-parameters">
                    <div class="parameter-item">
                      <label>Main Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['mainLength'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['mainLength']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Main Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['mainWidth'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['mainWidth']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Extension Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['extensionLength'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['extensionLength']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Extension Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['extensionWidth'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['extensionWidth']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="houseSpecs.shapeType === HouseShapeType.TShape" class="dimension-parameters">
                    <div class="parameter-item">
                      <label>Main Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['mainLength'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['mainLength']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Main Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['mainWidth'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['mainWidth']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Cross Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['crossLength'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['crossLength']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Cross Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['crossWidth'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['crossWidth']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="houseSpecs.shapeType === HouseShapeType.UShape" class="dimension-parameters">
                    <div class="parameter-item">
                      <label>Base Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['baseLength'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['baseLength']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Base Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['baseWidth'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['baseWidth']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Left Wing Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['leftWingLength'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['leftWingLength']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Left Wing Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['leftWingWidth'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['leftWingWidth']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Right Wing Length</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['rightWingLength'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['rightWingLength']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                    <div class="parameter-item">
                      <label>Right Wing Width</label>
                      <div *ngIf="!editMode.houseSpecs" class="parameter-value">{{ houseSpecs['rightWingWidth'] || 0 }} m</div>
                      <div *ngIf="editMode.houseSpecs" class="parameter-input">
                        <input type="number" [(ngModel)]="houseSpecs['rightWingWidth']" min="0" step="0.1" class="form-control">
                        <span class="unit">m</span>
                      </div>
                    </div>
                  </div>
                </div>
<div class="specs-section floors-section">
  <h3>Floors</h3>
  <div *ngIf="!editMode.houseSpecs" class="floors-display">
    <div class="parameter-item">
      <label>Number of Floors</label>
      <div class="parameter-value">{{ houseSpecs.numFloors || 1 }}</div>
    </div>
    
    <div class="floors-list">
      <ng-container *ngIf="houseSpecs.floors && houseSpecs.floors.length > 0; else noFloors">
        <div *ngFor="let floor of houseSpecs.floors; let i = index" class="floor-item">
          <div class="floor-header">
            <h4>{{ i === 0 ? 'Ground Floor' : 'Floor ' + i }}</h4>
          </div>
          <div class="floor-details">
            <div class="floor-parameter">
              <label>Height</label>
              <div class="parameter-value">{{ floor.floorHeigth || (i === 0 ? 3.0 : 2.8) }} m</div>
            </div>
          </div>
        </div>
      </ng-container>
      
      <ng-template #noFloors>
        <div class="no-floors">
          <p>No floor details specified. System will use default floor heights.</p>
        </div>
      </ng-template>
    </div>
  </div>
  <div *ngIf="editMode.houseSpecs" class="floors-editor">
    <div class="parameter-item">
      <label for="numFloors">Number of Floors</label>
      <div class="parameter-input">
        <select id="numFloors" [(ngModel)]="houseSpecs.numFloors" (change)="updateFloorsArray()" class="form-control">
          <option [value]="1">1 (Ground Floor)</option>
          <option [value]="2">2 (Ground Floor + 1)</option>
          <option [value]="3">3 (Ground Floor + 2)</option>
          <option [value]="4">4 (Ground Floor + 3)</option>
          <option [value]="5">5 (Ground Floor + 4)</option>
        </select>
      </div>
    </div>
    
    <div class="floors-list-editor">
      <ng-container *ngIf="ensureFloorsArray()">
        <div *ngFor="let floor of houseSpecs.floors; let i = index" class="floor-item-editor">
          <div class="floor-header">
            <h4>{{ i === 0 ? 'Ground Floor' : 'Floor ' + i }}</h4>
          </div>
          <div class="floor-details-editor">
            <div class="floor-parameter">
              <label [for]="'floorHeight' + i">Height</label>
              <div class="parameter-input">
                <input 
                  [id]="'floorHeight' + i" 
                  type="number" 
                  [(ngModel)]="floor.floorHeigth" 
                  min="2.0" 
                  max="5.0" 
                  step="0.1" 
                  class="form-control">
                <span class="unit">m</span>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>
  
            </div>
          </div>
        
<div class="specs-section materials-section" *ngIf="houseSpecs">
  <h3>Materials</h3>
  <div *ngIf="!editMode.houseSpecs" class="materials-display">
    <div class="materials-cards">
      <div class="material-card">
        <div class="material-header">
          <div class="material-header-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="4" width="20" height="18" rx="1" />
              <line x1="2" y1="10" x2="22" y2="10" />
              <line x1="2" y1="16" x2="22" y2="16" />
              <line x1="8" y1="4" x2="8" y2="10" />
              <line x1="16" y1="4" x2="16" y2="10" />
              <line x1="12" y1="10" x2="12" y2="16" />
              <line x1="8" y1="16" x2="8" y2="22" />
              <line x1="16" y1="16" x2="16" y2="22" />
            </svg>
          </div>
          <div class="material-header-text">Wall Material</div>
        </div>
        <div class="material-preview">
          <div class="material-swatch" 
     [style.background-color]="houseSpecs.wallMaterial.color"
     [ngClass]="{'transparent-background': isTransparent(houseSpecs.wallMaterial.color || '')}">
  <div class="material-texture-overlay" 
       *ngIf="houseSpecs.wallMaterial.texturePath" 
       [style.background-image]="'url(' + houseSpecs.wallMaterial.texturePath + ')'">
  </div>
</div>
        </div>
        <div class="material-details">
          <div class="material-name">
            <div class="material-type-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
              </svg>
            </div>
            {{ getMaterialTypeName(houseSpecs.wallMaterial.type) }}
          </div>
          <div class="material-properties">
            <div class="material-property">
              <div class="property-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10" />
                  <circle cx="12" cy="12" r="4" />
                </svg>
              </div>
              <div class="material-color-code">
                <span class="color-dot" [style.background-color]="houseSpecs.wallMaterial.color"></span>
                {{ houseSpecs.wallMaterial.color }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="material-card">
        <div class="material-header">
          <div class="material-header-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 10.5V19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-8.5" />
              <polyline points="3 10.5 12 3 21 10.5" />
              <path d="M9 14v5" />
              <path d="M15 14v5" />
            </svg>
          </div>
          <div class="material-header-text">Roof Material</div>
        </div>
        <div class="material-preview">
          <div class="material-swatch" 
     [style.background-color]="houseSpecs.roofMaterial.color"
     [ngClass]="{'transparent-background': isTransparent(houseSpecs.roofMaterial.color || '')}">
  <div class="material-texture-overlay" 
       *ngIf="houseSpecs.roofMaterial.texturePath" 
       [style.background-image]="'url(' + houseSpecs.roofMaterial.texturePath + ')'">
  </div>
</div>
        </div>
        <div class="material-details">
          <div class="material-name">
            <div class="material-type-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
              </svg>
            </div>
            {{ getMaterialTypeName(houseSpecs.roofMaterial.type) }}
          </div>
          <div class="material-properties">
            <div class="material-property">
              <div class="property-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10" />
                  <circle cx="12" cy="12" r="4" />
                </svg>
              </div>
              <div class="material-color-code">
                <span class="color-dot" [style.background-color]="houseSpecs.roofMaterial.color"></span>
                {{ houseSpecs.roofMaterial.color }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="material-card">
        <div class="material-header">
          <div class="material-header-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="5" width="18" height="18" rx="1" />
              <line x1="3" y1="9" x2="21" y2="9" />
              <line x1="3" y1="13" x2="21" y2="13" />
              <line x1="3" y1="17" x2="21" y2="17" />
              <line x1="8" y1="5" x2="8" y2="25" />
              <line x1="16" y1="5" x2="16" y2="25" />
            </svg>
          </div>
          <div class="material-header-text">Floor Material</div>
        </div>
        <div class="material-preview">
          <div class="material-swatch" 
     [style.background-color]="houseSpecs.floorMaterial.color"
     [ngClass]="{'transparent-background': isTransparent(houseSpecs.floorMaterial.color || '')}">
  <div class="material-texture-overlay" 
       *ngIf="houseSpecs.floorMaterial.texturePath" 
       [style.background-image]="'url(' + houseSpecs.floorMaterial.texturePath + ')'">
  </div>
</div>
        </div>
        <div class="material-details">
          <div class="material-name">
            <div class="material-type-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
              </svg>
            </div>
            {{ getMaterialTypeName(houseSpecs.floorMaterial.type) }}
          </div>
          <div class="material-properties">
            <div class="material-property">
              <div class="property-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10" />
                  <circle cx="12" cy="12" r="4" />
                </svg>
              </div>
              <div class="material-color-code">
                <span class="color-dot" [style.background-color]="houseSpecs.floorMaterial.color"></span>
                {{ houseSpecs.floorMaterial.color }}
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
<div *ngIf="customWallMaterials.length > 0" class="custom-walls-display">
  <h4 class="custom-walls-title">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <rect x="7" y="7" width="3" height="9"></rect>
      <rect x="14" y="7" width="3" height="5"></rect>
    </svg>
    Customized Walls
  </h4>
  
  <div class="custom-walls-cards">
    <div *ngFor="let customMaterial of customWallMaterials" class="custom-wall-card">
      <div class="custom-wall-header">
        <div class="custom-wall-position">{{ getWallPositionName(customMaterial.position) }}</div>
      </div>
      <div class="custom-wall-preview">
<div class="custom-wall-swatch" 
     [style.background-color]="customMaterial.material.color"
     [ngClass]="{'transparent-background': isTransparent(customMaterial.material.color || '')}">
  <div class="material-texture-overlay" 
       *ngIf="customMaterial.material.texturePath" 
       [style.background-image]="'url(' + customMaterial.material.texturePath + ')'">
  </div>
</div>
      </div>
      <div class="custom-wall-details">
        <div class="custom-wall-material-name">{{ getMaterialTypeName(customMaterial.material.type) }}</div>
        <div class="custom-wall-color-code">
          <span class="color-dot" [style.background-color]="customMaterial.material.color"></span>
          {{ customMaterial.material.color }}
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
  
  <div *ngIf="editMode.houseSpecs" class="materials-editor">
    <div class="material-editor-section">
      <h4>
        Wall Material
      </h4>
      <app-material-selector 
        materialType="wall"
        [material]="houseSpecs.wallMaterial"
        (materialChange)="onWallMaterialChange($event)">
      </app-material-selector>
    </div>
    <div class="material-editor-section">
      <h4>
        Roof Material
      </h4>
      <app-material-selector 
        materialType="roof"
        [material]="houseSpecs.roofMaterial"
        (materialChange)="onRoofMaterialChange($event)">
      </app-material-selector>
    </div>
    
    <div class="material-editor-section">
      <h4>
        Floor Material
      </h4>
      <app-material-selector 
        materialType="floor"
        [material]="houseSpecs.floorMaterial"
        (materialChange)="onFloorMaterialChange($event)">
      </app-material-selector>
    </div>
    
<div *ngIf="editMode.houseSpecs" class="custom-walls-section material-editor-section">
  <h4>
    Customize Individual Walls
  </h4>
  
  <div class="custom-walls-toggle">
    <div class="toggle-label">
      <span>Apply different materials to each wall</span>
    </div>
    
    <label class="switch">
      <input type="checkbox" [(ngModel)]="useCustomWallMaterials">
      <span class="slider round"></span>
    </label>
  </div>
  
  <div *ngIf="useCustomWallMaterials" class="walls-customization">
    <div class="wall-tabs">
      <div class="wall-tab" 
           *ngFor="let wallOption of getAvailableWalls()" 
           [class.active]="selectedWallPosition === wallOption.value"
           (click)="selectedWallPosition = wallOption.value">
        {{ wallOption.name }}
      </div>
    </div>
    <div class="selected-wall-editor">
      <h5>{{ getWallPositionName(selectedWallPosition) }} Wall</h5>
      
      <div *ngIf="getOrCreateCustomWallMaterial(selectedWallPosition) as wallMaterial">
        <app-material-selector 
          [materialType]="'wall'"
          [material]="wallMaterial.material"
          (materialChange)="updateCustomWallMaterial(selectedWallPosition, $event)">
        </app-material-selector>
      </div>
    </div>
    <div class="custom-materials-summary" *ngIf="customWallMaterials.length > 0">
      <h5>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <rect x="7" y="7" width="3" height="9"></rect>
          <rect x="14" y="7" width="3" height="5"></rect>
        </svg>
        Customized Walls
      </h5>
      <div class="custom-materials-chips">
        <div *ngFor="let customMaterial of customWallMaterials" class="custom-material-chip">
          <div class="chip-color" [style.background-color]="customMaterial.material.color"></div>
          <div class="chip-name">{{ getWallPositionName(customMaterial.position) }}</div>
          <button class="chip-remove" (click)="removeCustomWallMaterial(customMaterial.position)">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>
<div *ngIf="!editMode.houseSpecs" class="view-3d-section">
  <div class="project-actions-card">
    <div class="actions-header">
      <h3 class="actions-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 21.7L4 16V8l8-5.7 8 5.7v8l-8 5.7z"></path>
          <path d="M12 16V8"></path>
          <path d="M8 12L16 12"></path>
        </svg>
        3D Visualization & Sharing
      </h3>
    </div>
    
    <div class="actions-body">
      <div class="primary-action">
        <button class="view-3d-button" (click)="viewIn3D()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 21.7L4 16V8l8-5.7 8 5.7v8l-8 5.7z"></path>
            <path d="M12 16V8"></path>
            <path d="M8 12L16 12"></path>
          </svg>
          View House in 3D
        </button>
      </div>

      <div class="gallery-section" *ngIf="!loading.project">
        
        <div *ngIf="!houseSpecsId" class="gallery-status-item">
          <div class="status-indicator warning">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
          </div>
          <div class="status-content">
            <p class="status-message">Complete specifications required</p>
            <p class="status-description">Add house specifications to enable gallery publishing</p>
          </div>
        </div>

        <div *ngIf="houseSpecsId && !isProjectPublic && !checkingPublicStatus" class="gallery-status-item">
          <div class="status-indicator ready">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <div class="status-content">
            <p class="status-message">Ready to share with community</p>
            <p class="status-description">Your house design is complete and ready to be published</p>
          </div>
          <div class="status-actions">
            <button class="action-btn publish-btn" (click)="openPublishModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Publish to Gallery
            </button>
          </div>
        </div>

        <div *ngIf="houseSpecsId && isProjectPublic && !checkingPublicStatus" class="gallery-status-item">
          <div class="status-indicator published">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </div>
          <div class="status-content">
            <p class="status-message">Live in community gallery</p>
            <p class="status-description">Your design is publicly visible and earning community feedback</p>
          </div>
          <div class="status-actions">
            <button class="action-btn view-btn" (click)="redirectToGallery()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              View in Gallery
            </button>
            <button class="action-btn remove-btn" (click)="removeFromGallery()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Remove
            </button>
          </div>
        </div>

        <div *ngIf="checkingPublicStatus" class="gallery-status-item">
          <div class="status-indicator loading">
            <div class="loading-spinner"></div>
          </div>
          <div class="status-content">
            <p class="status-message">Checking publication status...</p>
            <p class="status-description">Please wait while we verify your project status</p>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</div>

<app-publish-project-modal
  [isOpen]="showPublishModal"
  [project]="project"
  (close)="closePublishModal()"
  (published)="onProjectPublished()"
></app-publish-project-modal>

<app-confirmation-modal
  [isOpen]="showDeleteConfirmation"
  title="Delete Project"
  message="Are you sure you want to delete this project? This action cannot be undone and will permanently remove all project data including house specifications."
  confirmText="Yes, Delete"
  cancelText="Cancel"
  (confirm)="onConfirmDelete()"
  (cancel)="onCancelDelete()">
</app-confirmation-modal>

<app-confirmation-modal
  [isOpen]="showRemoveFromGalleryConfirmation"
  title="Remove from Gallery"
  message="Are you sure you want to remove this project from the public gallery? It will no longer be visible to other users."
  confirmText="Yes, Remove"
  cancelText="Cancel"
  (confirm)="onConfirmRemoveFromGallery()"
  (cancel)="onCancelRemoveFromGallery()">
</app-confirmation-modal>